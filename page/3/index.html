
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>一奔二飛</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Jordan Huang">
    

    
    <meta name="description" content="學習紀錄">
<meta property="og:type" content="website">
<meta property="og:title" content="一奔二飛">
<meta property="og:url" content="http://good5dog5.github.io/page/3/index.html">
<meta property="og:site_name" content="一奔二飛">
<meta property="og:description" content="學習紀錄">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="一奔二飛">
<meta name="twitter:description" content="學習紀錄">

    
    <link rel="alternative" href="/atom.xml" title="一奔二飛" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <meta name="google-site-verification" content="x99kAHj-gCMS5M9ADRJOZwI_xsHXfgWfUpOcAhEivNk" />
    <meta name="google-site-verification" content="x99kAHj-gCMS5M9ADRJOZwI_xsHXfgWfUpOcAhEivNk" />
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="一奔二飛" title="一奔二飛"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="一奔二飛">一奔二飛</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/14/hw_raytracing/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2016-03-13T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <ul>
  <li><a href="https://github.com/good5dog5/raytracing" target="_blank" rel="external">github repository</a></li>
  <li><a href="http://wiki.csie.ncku.edu.tw/embedded/2016q1h2" target="_blank" rel="external">課程網頁</a></li>
</ul>

<h2 id="a">作業(A)</h2>
<hr>

<h3 id="section">目標</h3>
<blockquote>
  <ul>
    <li>以 <code class="highlighter-rouge">make PROFILE=1</code> 重新編譯程式碼，並且學習 <a href="https://sourceware.org/binutils/docs/gprof/" target="_blank" rel="external">gprof</a></li>
    <li>以 <code class="highlighter-rouge">gprof</code> 指出效能瓶頸，並且著手改寫檔案 <code class="highlighter-rouge">math-toolkit.h</code> 在內的函式實做，充分紀錄效能差異在共筆</li>
    <li>注意: 請勿更動編譯器最佳化選項 <code class="highlighter-rouge">-O0</code> (關閉最佳化)</li>
    <li>檔案 math-toolkit.h 定義的若干數學操作函式很重要，可參考 <a href="http://tomjbward.co.uk/simd-optimized-dot-and-cross/" target="_blank" rel="external">SIMD optimized dot and cross product functions</a> 和 <a href="http://wiki.csie.ncku.edu.tw/embedded/2015q3h1ext" target="_blank" rel="external">2015q3 Homework #1 Ext</a><br>
將你的觀察、分析，以及各式效能改善過程，並善用 <code class="highlighter-rouge">gnuplot</code> 製圖。</li>
  </ul>
</blockquote>

<h3 id="gprof---gun-profiler">gprof - Gun Profiler</h3>

<hr>

<p>Profiling能讓程式撰寫者了解程式花在各function的時間和function間的呼叫關係，並能有效找出與預期有落差的funciton，
改善整體效能。</p>

<p>gprof需要在compile時加入 <code class="highlighter-rouge">-pg</code> flag，如此會告知 <code class="highlighter-rouge">gcc</code> 在compile時為每個function加入名為mcount ( or  “_mcount”  , or  “__mcount” , depend on compiler and OS.)的函数
則每個funciton執行時都會call mcount，而mcount會存有一份calling graph，裡頭紀錄了child function和parent funciton的關係，呼叫時間以及呼叫次數等資訊。</p>

<p>利用<code class="highlighter-rouge">make PROFILE=1</code>編譯時：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ifeq <span class="o">(</span><span class="k">$(</span>strip <span class="k">$(</span>PROFILE<span class="k">))</span>,1<span class="o">)</span>
PROF_FLAGS <span class="o">=</span> -pg
CFLAGS +<span class="o">=</span> <span class="k">$(</span>PROF_FLAGS<span class="k">)</span>
LDFLAGS +<span class="o">=</span> <span class="k">$(</span>PROF_FLAGS<span class="k">)</span> 
endif
</code></pre>
</div>

<p><code class="highlighter-rouge">$(strip $(PROFILE)), 1)</code>，strip去掉$PROFILE的開頭結尾空字符
比較$PROFILE==1?，成立時則將<code class="highlighter-rouge">CFLAGS</code>和 <code class="highlighter-rouge">LDFLAGS</code> 加入 <code class="highlighter-rouge">-pg</code>字串
因為在runtime會多執行mcount，故執行時間會比沒有加<code class="highlighter-rouge">-pg</code>flag的慢許多。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make <span class="nv">PROFILE</span><span class="o">=</span>1
</code></pre>
</div>
<p>執行 ./raytracing，得到gmon.out(只能用gprof來讀取)，並把data 
redirect到<code class="highlighter-rouge">analysis.txt</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gprof raytracing gmon.out &gt; analysis.txt  
</code></pre>
</div>

<h3 id="graphvizhttpwwwgraphvizorg-">利用 <a href="http://www.graphviz.org/" target="_blank" rel="external">Graphviz</a> 產生函數呼叫關係圖</h3>

<blockquote>
  <p>Graphviz is open source graph visualization software. Graph visualization is a 
way of representing structural information as diagrams of abstract graphs and 
networks. It has important applications in networking, bioinformatics,  software 
engineering, database and web design, machine learning, and in visual interfaces 
for other technical domains.</p>
</blockquote>

<ol>
  <li>利用<a href="https://github.com/jrfonseca/gprof2dot" target="_blank" rel="external">gprof2dot</a>，將<code class="highlighter-rouge">gmon.out</code>轉成<code class="highlighter-rouge">graphviz</code>
所用的<code class="highlighter-rouge">dot language</code></li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#安裝</span>
pip install gprof2dot
</code></pre>
</div>

<p><code class="highlighter-rouge">analysis.txt</code> 中分為幾個部份</p>

<ol>
  <li><a href="https://sourceware.org/binutils/docs/gprof/Flat-Profile.html" target="_blank" rel="external">Flat Profile</a><br>
<strong>The flat profile shows the total amount of time your program spent executing each function.</strong></li>
</ol>

<p><img src="https://dl.dropboxusercontent.com/u/31201582/Blogger/2016-03-14-hw_raytracing/flat-profile.png" alt="raytracing的gprfo圖">
各column分別代表</p>

<ul>
  <li><code class="highlighter-rouge">time</code><br>
  function執行時間的百分比，加總起來應為100%。</li>
  <li><code class="highlighter-rouge">cumulative seconds</code><br>
  此function的執行時間(second)，加上此funciton之前functions執行時間的總和。</li>
  <li><code class="highlighter-rouge">self seconds</code><br>
  此function獨自執行的時間，flat profile以此column為第一順位排序。</li>
  <li><code class="highlighter-rouge">calls</code>
  此function被called的次數，如果被called的次數沒辦法被統計或
  This is the total number of times the function was called. If the function was never called, or the number of times it was called cannot be determined (probably because the function was not compiled with profiling enabled), the calls field is blank.</li>
  <li><code class="highlighter-rouge">self ms/call</code><br>
  代表 <strong>average number of milliseconds spent in this function per call</strong>， 若沒被profiled則為空。</li>
  <li><code class="highlighter-rouge">total ms/call</code><br>
  This represents the average number of milliseconds spent in this function and its descendants per call, if this function is profiled. Otherwise, this field is blank for this function. This is the only field in the flat profile that uses call graph analysis.</li>
  <li><code class="highlighter-rouge">name</code><br>
  funtion name.</li>
</ul>

<p>由flat profile中可發現，主要的效能瓶頸在</p>

<table>
  <thead>
    <tr>
      <th>function name</th>
      <th style="text-align: center">calls</th>
      <th style="text-align: right">second</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>dot_product</td>
      <td style="text-align: center">69646433</td>
      <td style="text-align: right">1.19</td>
    </tr>
    <tr>
      <td>subtract_vector</td>
      <td style="text-align: center">56956357</td>
      <td style="text-align: right">0.58</td>
    </tr>
    <tr>
      <td>multiply_vector</td>
      <td style="text-align: center">31410180</td>
      <td style="text-align: right">0.34</td>
    </tr>
  </tbody>
</table>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/14/hw_raytracing/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/08/phonebook/" title="嵌入式系統作業 - Phonebook效能改進與分析" itemprop="url">嵌入式系統作業 - Phonebook效能改進與分析</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2016-03-07T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://github.com/good5dog5/phonebook"><strong>github repository</strong></a>  </p>
<p>參考<a href="http://wiki.csie.ncku.edu.tw/embedded/2016q1h1">課程網頁</a>的作業要求：  </p>
<blockquote>
<ul>
<li>在 GitHub 上 fork phonebook，然後適度修改 <code>phonebook_opt.c</code>和 <code>phonebook_opt.h</code>兩個檔案，使得這兩者執行時期的 cache miss 降低。請用 perf 驗證，而且改進的過程中，不能有功能方面的減損。</li>
<li><code>phonebook_orig.[ch]</code> 不需要修改，我們關注的是 <code>phonebook_opt.[ch]</code>，當然要修改 <code>main.c</code> 也是允許的</li>
<li><code>findName()</code> 的時間必須原本的時間更短</li>
<li><code>append()</code> 的時間可以比原始版本稍久，但不應該增加太多</li>
<li>main.c 應該只有一份，不要建立新的 <code>main()</code>，善用 Makefile 定義對應的 CFLAGS</li>
</ul>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/08/phonebook/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/C/">C</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/C/">C</a><a href="/tags/gdb/">gdb</a><a href="/tags/embedded-system/">embedded system</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/08/phonebook/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/08/phonebook/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2016-03-07T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://github.com/good5dog5/phonebook" target="_blank" rel="external"><strong>github repository</strong></a></p>

<p>參考<a href="http://wiki.csie.ncku.edu.tw/embedded/2016q1h1" target="_blank" rel="external">課程網頁</a>的作業要求：</p>

<blockquote>
  <ul>
    <li>在 GitHub 上 fork phonebook，然後適度修改 <code class="highlighter-rouge">phonebook_opt.c</code>和 <code class="highlighter-rouge">phonebook_opt.h</code>兩個檔案，使得這兩者執行時期的 cache miss 降低。請用 perf 驗證，而且改進的過程中，不能有功能方面的減損。</li>
    <li><code class="highlighter-rouge">phonebook_orig.[ch]</code> 不需要修改，我們關注的是 <code class="highlighter-rouge">phonebook_opt.[ch]</code>，當然要修改 <code class="highlighter-rouge">main.c</code> 也是允許的</li>
    <li><code class="highlighter-rouge">findName()</code> 的時間必須原本的時間更短</li>
    <li><code class="highlighter-rouge">append()</code> 的時間可以比原始版本稍久，但不應該增加太多</li>
    <li>main.c 應該只有一份，不要建立新的 <code class="highlighter-rouge">main()</code>，善用 Makefile 定義對應的 CFLAGS</li>
  </ul>
</blockquote>

<p>先來看看 <code class="highlighter-rouge">phonebook_orig.h</code> 內的entry struct</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">__PHONE_BOOK_ENTRY</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">lastName</span><span class="p">[</span><span class="n">MAX_LAST_NAME_SIZE</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">firstName</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">email</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">phone</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">cell</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">addr1</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">addr2</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">city</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">zip</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">__PHONE_BOOK_ENTRY</span> <span class="o">*</span><span class="n">pNext</span><span class="p">;</span>
<span class="p">}</span> <span class="n">entry</span><span class="p">;</span>
</code></pre>
</div>

<ul>
  <li>用GDB print sizeof(entry)得出size為136 bytes，但entry中member的總size
應該為131 bytes，因為word alignment的關係才湊成136(136%8=0)。</li>
</ul>

<p>接著看 <code class="highlighter-rouge">main.c</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
#include &lt;assert.h&gt;
</span>
<span class="cp">#include IMPL      // WTF?
</span>
<span class="cp">#define DICT_FILE "./dictionary/words.txt"
</span></code></pre>
</div>
<p>#include IMPL須連Makefile一起看才能理解#</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">SRCS_common</span> <span class="o">=</span> main.c

<span class="nl">phonebook_orig</span><span class="o">:</span> <span class="nf">$(SRCS_common) phonebook_orig.c phonebook_orig.h</span>
	<span class="nv">$(CC)</span> <span class="nv">$(CFLAGS_common)</span> <span class="nv">$(CFLAGS_orig)</span> <span class="se">\</span>
		-DIMPL<span class="o">=</span><span class="s2">"</span><span class="se">\"</span><span class="nv">$@</span><span class="s2">.h</span><span class="se">\"</span><span class="s2">"</span> -o <span class="nv">$@</span> <span class="se">\</span>
		<span class="nv">$(SRCS_common)</span> <span class="nv">$@</span>.c

<span class="nl">phonebook_opt</span><span class="o">:</span> <span class="nf">$(SRCS_common) phonebook_opt.c phonebook_opt.h</span>
	<span class="nv">$(CC)</span> <span class="nv">$(CFLAGS_common)</span> <span class="nv">$(CFLAGS_opt)</span> <span class="se">\</span>
		-DIMPL<span class="o">=</span><span class="s2">"</span><span class="se">\"</span><span class="nv">$@</span><span class="s2">.h</span><span class="se">\"</span><span class="s2">"</span> -o <span class="nv">$@</span> <span class="se">\</span>
		<span class="nv">$(SRCS_common)</span> <span class="nv">$@</span>.c
</code></pre>
</div>
<p>-DIMPL 會把main.c中的 #include IMPL換成 phonebook_opt.h或 phonebook_orig.h</p>

<h3 id="perf">利用perf尋找程式熱點</h3>
<p><code class="highlighter-rouge">./phonebook_orig &amp; sudo perf top -p $!</code></p>

<h2 id="cache">cache</h2>
<p>因為我們對此次作業cache misses很在意，故要排除系統cache 的影響，
在每次執行之前手動藉由</p>

<p><code class="highlighter-rouge">echo 1 &gt; /proc/sys/vm/drop_caches</code>來釋放cache。
&gt;<code class="highlighter-rouge">Freeing the page cache:</code><br>
&gt;echo 1 &gt; /proc/sys/vm/drop_caches<br>
&gt;<code class="highlighter-rouge">Free dentries and inodes:</code><br>
&gt;echo 2 &gt; /proc/sys/vm/drop_caches<br>
&gt;<code class="highlighter-rouge">Free the page cache, dentries and the inodes:</code><br>
&gt;echo 3 &gt; /proc/sys/vm/drop_caches</p>

<h2 id="optimize">開始optimize!</h2>

<h3 id="entry">1.減少entry的大小</h3>
<hr>

<p>原本的entry耗用136 bytes，但<code class="highlighter-rouge">append()</code>只會用到entry.lastName這個member
故把其他不相干的members都註解掉，比較原本的cache misses和註解掉後的cache misses。</p>

<p>註解前：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Performance counter stats for './phonebook_opt' (100 runs):  

         1,998,548      cache-misses              #   `94.496 % of all cache refs`  ( +-  0.33% )
         2,114,954      cache-references                                              ( +-  0.20% )
       263,123,256      instructions              #    1.40  insns per cycle          ( +-  0.02% )
       187,765,109      cycles                                                        ( +-  0.68% )

       0.072710909 seconds time elapsed                                               ( +-  0.68% )
</code></pre>
</div>

<p>註解後</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">__PHONE_BOOK_ENTRY</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">lastName</span><span class="p">[</span><span class="n">MAX_LAST_NAME_SIZE</span><span class="p">];</span>
    <span class="c1">// char firstName[16];
</span>    <span class="c1">// char email[16];
</span>    <span class="c1">// char phone[10];
</span>    <span class="c1">// char cell[10];
</span>    <span class="c1">// char addr1[16];
</span>    <span class="c1">// char addr2[16];
</span>    <span class="c1">// char city[16];
</span>    <span class="c1">// char state[2];
</span>    <span class="c1">// char zip[5];
</span>    <span class="k">struct</span> <span class="n">__PHONE_BOOK_ENTRY</span> <span class="o">*</span><span class="n">pNext</span><span class="p">;</span>
<span class="p">}</span> <span class="n">entry</span><span class="p">;</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Performance counter stats for './phonebook_opt' (100 runs):

           251,887      cache-misses              #   74.614 % of all cache refs      ( +-  0.13% )
           337,587      cache-references                                              ( +-  1.47% )
       242,971,052      instructions              #    1.81  insns per cycle          ( +-  0.02% )
       134,352,512      cycles                                                        ( +-  0.99% )

       0.052137429 seconds time elapsed                                               ( +-  1.03% )
</code></pre>
</div>

<p><img src="https://dl.dropboxusercontent.com/u/31201582/Blogger/2016-03-08-phonebook/comment_out_members.png" alt="Comment 後的 performance"><br>
### 2. Hashing
—
採用<a href="http://www.partow.net/programming/hashfunctions/#BKDRHashFunction" target="_blank" rel="external">BKDR hash</a>
&gt; This hash function comes from Brian Kernighan and Dennis Ritchie’s book “The C Programming Language”. It is a simple hash function using a strange set of possible seeds which all constitute a pattern of 31….31…31 etc, it seems to be very similar to the DJB hash function.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// BKDR Hash Function
</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">BKDRHash</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">131</span><span class="p">;</span> <span class="c1">// 31 131 1313 13131 131313 etc..
</span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span> <span class="o">*</span> <span class="n">seed</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="o">++</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">hash</span> <span class="o">&amp;</span> <span class="mh">0x7FFFFFFF</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>原來是來自Brian Kernighan and Dennis Ritchie’s的書，所以才較BKDR阿，是個易於記憶，效能也不錯的hash funciton。
修改成用bit operation，較為有效率</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">BKDRHash</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="p">(</span><span class="n">hash</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="n">hash</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="o">++</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">hash</span> <span class="o">%</span> <span class="n">SIZE</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p><img src="https://dl.dropboxusercontent.com/u/31201582/Blogger/2016-03-08-phonebook/hash_vi.png" alt="最終的效能比較圖"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/08/phonebook/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/07/offlineimap-config/" title="Mutt手把手：offlineimap設定" itemprop="url">Mutt手把手：offlineimap設定</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2016-03-06T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>一直以來都用web界面來收發mail，接觸Linux後知道很多軟體都有對應的command line神器，而mutt就是email領域的神器。</p>
<p>而跟所有CLI神器一樣，要享受方便之前需要很多configuration，設定自己習慣的key binding，能為日後的使用省下大量的時間，<br>俗話說萬事起頭難，mutt的設定是目前我遇過數一數二難的，mutt依循Unix的設計哲學:只做一見事情，並把他做好(<a href="http://www.catb.org/esr/writings/taoup/html/ch01s06.html">Do one thing and do it well</a>)</p>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/07/offlineimap-config/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/CLI/">CLI</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/CLI/">CLI</a><a href="/tags/config/">config</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/07/offlineimap-config/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/07/offlineimap-config/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2016-03-06T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>一直以來都用web界面來收發mail，接觸Linux後知道很多軟體都有對應的command line神器，而mutt就是email領域的神器。</p>

<p>而跟所有CLI神器一樣，要享受方便之前需要很多configuration，設定自己習慣的key binding，能為日後的使用省下大量的時間，
俗話說萬事起頭難，mutt的設定是目前我遇過數一數二難的，mutt依循Unix的設計哲學:只做一見事情，並把他做好(<a href="http://www.catb.org/esr/writings/taoup/html/ch01s06.html" target="_blank" rel="external">Do one thing and do it well</a>)</p>

<h3 id="mutt-">MUtt 簡介</h3>
<p>根據 <a href="https://wiki.archlinux.org/index.php/Mutt" target="_blank" rel="external">Arch wiki</a>:</p>

<blockquote>
  <p>Mutt is a text-based mail client renowned for its powerful features.
Though over 2 decades old, Mutt remains the mail client of choice for a great number of power-users. 
Unfortunately, a default Mutt install is plagued by complex keybindings along with a daunting amount of documentation. 
This guide will help the average user get Mutt up and running, and begin customizing it to their particular needs.</p>
</blockquote>

<p>Mutt一開始是設計作為MUA(Mail User Agent),即只有閱讀信件的功能，其他如收寄信功能則須由其他程式協助完成，
mutt只提共對應的界面。</p>

<h3 id="offlineimap">收信，先從設定offlineimap開始</h3>

<p>Mutt會由local disk中的mail folder讀取信件，而信件透過 IMAP 或 POP3 等協定從mail server下載到local
端的mail folder，目前最廣為採用的mail sync程式為<a href="http://www.offlineimap.org/" target="_blank" rel="external">offlineIMAP</a>，
透過設定 offlineimaprc 可以讓 offlineimap 有效且快速的同步多帳號的 mail。</p>

<p>1.offlineimaprc</p>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/07/offlineimap-config/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/10/22/Began_working/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2014-10-21T16:00:00.000Z" itemprop="datePublished"> Published 2014-10-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>從退伍到找工作中間過了快一個月，和原本預期退伍後就要馬上無縫接軌工作的預期有些落差,但比起一般兩個月的等待期貌似順利了不少，期間面試了約略七八間公司，錄取了三間，到最後選擇了位在五股的訊舟作為第一個落腳點。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2014/10/22/Began_working/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/10/22/Began_working/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/10/22/Began_working/" title="開始工作之後" itemprop="url">開始工作之後</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2014-10-21T16:00:00.000Z" itemprop="datePublished"> Published 2014-10-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>從退伍到找工作中間過了快一個月，和原本預期退伍後就要馬上無縫接軌工作的預期有些落差,但比起一般兩個月的等待期貌似順利了不少，期間面試了約略七八間公司，錄取了三間，到最後選擇了位在五股的訊舟作為第一個落腳點。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2014/10/22/Began_working/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/daily/">daily</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/job/">job</a><a href="/tags/daily/">daily</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/10/22/Began_working/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/10/16/Jobs_going/" title="Linux學習心得" itemprop="url">Linux學習心得</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2014-10-15T16:00:00.000Z" itemprop="datePublished"> Published 2014-10-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>大學剛開始就有種錯誤的期待，覺得必須把過去沒玩到的加倍討回來，整個校園有太多歡樂值得探尋，錯誤的把蹺課理解成大學賦於學生的一種選擇，於是乎成績就一直平平，甚至於，低落。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2014/10/16/Jobs_going/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a>
  </div>

</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/10/16/Jobs_going/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/10/16/Jobs_going/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jordan Huang" target="_blank" itemprop="author">Jordan Huang</a>
		
  <p class="article-time">
    <time datetime="2014-10-15T16:00:00.000Z" itemprop="datePublished"> Published 2014-10-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>大學剛開始就有種錯誤的期待，覺得必須把過去沒玩到的加倍討回來，整個校園有太多歡樂值得探尋，錯誤的把蹺課理解成大學賦於學生的一種選擇，於是乎成績就一直平平，甚至於，低落。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2014/10/16/Jobs_going/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>



<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/10/16/Jobs_going/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/good5dog5" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:good5dog5@gmail.com## e.g. imjark@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="good5dog5" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Blog/" title="Blog">Blog<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/C/" title="C">C<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/CLI/" title="CLI">CLI<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Homework/" title="Homework">Homework<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Job/" title="Job">Job<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Note/" title="Note">Note<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Tools/" title="Tools">Tools<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Work/" title="Work">Work<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/daily/" title="daily">daily<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Note/" title="Note">Note<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/embedded-system/" title="embedded system">embedded system<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C">C<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/c/" title="c">c<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Preprocessor/" title="Preprocessor">Preprocessor<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/note/" title="note">note<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/gdb/" title="gdb">gdb<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Resume/" title="Resume">Resume<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/vim/" title="vim">vim<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Blog/" title="Blog">Blog<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/CLI/" title="CLI">CLI<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Cml/" title="Cml">Cml<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Travis-CI/" title="Travis CI">Travis CI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Embedded-system/" title="Embedded system">Embedded system<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/job/" title="job">job<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Latex/" title="Latex">Latex<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/daily/" title="daily">daily<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Job/" title="Job">Job<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MIME-type/" title="MIME type">MIME type<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Jordan Huang">Jordan Huang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
